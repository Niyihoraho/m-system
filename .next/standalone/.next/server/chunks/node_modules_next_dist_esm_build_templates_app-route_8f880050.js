module.exports=[75064,e=>{"use strict";e.s(["handler",()=>U,"patchFetch",()=>P,"routeModule",()=>C,"serverHooks",()=>A,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>S],75064);var r=e.i(47909),t=e.i(74017),n=e.i(96250),s=e.i(59756),o=e.i(61916),a=e.i(69741),i=e.i(16795),u=e.i(87718),l=e.i(95169),d=e.i(47587),p=e.i(66012),c=e.i(70101),m=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var I=e.i(220);e.s(["DELETE",()=>w,"GET",()=>x,"GET_REGIONS",()=>G,"GET_UNIVERSITIES",()=>j,"POST",()=>N,"PUT",()=>b],74524);var h=e.i(15270),R=e.i(89171),y=e.i(70937),v=e.i(91773);async function N(e){try{let r=await (0,v.getUserScope)();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.json(),n=y.createMemberSchema.safeParse(t);if(!n.success)return R.NextResponse.json({error:"Validation failed",details:n.error.issues},{status:400});let s=n.data,o=(0,v.generateRLSConditions)(r);if(s.regionId&&o.regionId&&s.regionId!==o.regionId)return R.NextResponse.json({error:"You can only create members in your assigned region"},{status:403});if(s.universityId&&o.universityId&&s.universityId!==o.universityId)return R.NextResponse.json({error:"You can only create members in your assigned university"},{status:403});if(s.smallGroupId&&o.smallGroupId&&s.smallGroupId!==o.smallGroupId)return R.NextResponse.json({error:"You can only create members in your assigned small group"},{status:403});if(s.alumniGroupId&&o.alumniGroupId&&s.alumniGroupId!==o.alumniGroupId)return R.NextResponse.json({error:"You can only create members in your assigned alumni group"},{status:403});let a=e=>""===e||null==e?null:e,i=e=>""===e||null==e?null:Number(e),u=e=>""===e||null==e?null:new Date(e),l=await h.prisma.member.create({data:{firstname:a(s.firstname),secondname:a(s.secondname),gender:a(s.gender?.toLowerCase()),birthdate:u(s.birthdate),placeOfBirthProvince:a(s.placeOfBirthProvince),placeOfBirthDistrict:a(s.placeOfBirthDistrict),placeOfBirthSector:a(s.placeOfBirthSector),placeOfBirthCell:a(s.placeOfBirthCell),placeOfBirthVillage:a(s.placeOfBirthVillage),localChurch:a(s.localChurch),email:a(s.email),phone:a(s.phone),type:s.type.toLowerCase(),status:s.status?s.status.toLowerCase():"active",regionId:i(s.regionId),universityId:i(s.universityId),smallGroupId:i(s.smallGroupId),alumniGroupId:i(s.alumniGroupId),graduationDate:u(s.graduationDate),faculty:a(s.faculty),professionalism:a(s.professionalism),maritalStatus:a(s.maritalStatus),updatedAt:new Date}});return R.NextResponse.json(l,{status:201})}catch(e){if(console.error("Error creating member:",e),"object"==typeof e&&null!==e&&"code"in e){if("P2002"===e.code)return R.NextResponse.json({error:"Email already exists"},{status:409});if("P2003"===e.code)return R.NextResponse.json({error:"Foreign key constraint failed"},{status:400})}return R.NextResponse.json({error:"Internal server error"},{status:500})}}async function x(e){try{let r=await (0,v.getUserScope)();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),n=t.get("id"),s=t.get("smallGroupId"),o=t.get("alumniGroupId"),a=t.get("universityId"),i=t.get("regionId");if(n){let e=await h.prisma.member.findUnique({where:{id:Number(n)},include:{region:!0,university:!0,smallgroup:!0,alumnismallgroup:!0}});if(!e)return R.NextResponse.json({error:"Member not found"},{status:404});let t=(0,v.generateRLSConditions)(r);if(t.regionId&&e.regionId!==t.regionId||t.universityId&&e.universityId!==t.universityId||t.smallGroupId&&e.smallGroupId!==t.smallGroupId||t.alumniGroupId&&e.alumniGroupId!==t.alumniGroupId)return R.NextResponse.json({error:"Access denied"},{status:403});return R.NextResponse.json(e,{status:200})}let u=(0,v.generateRLSConditions)(r),l={...u};if(s){let e=Number(s);if(u.smallGroupId&&e!==u.smallGroupId)return R.NextResponse.json({error:"Access denied to requested small group"},{status:403});l.smallGroupId=e}else if(o){let e=Number(o);if(u.alumniGroupId&&e!==u.alumniGroupId)return R.NextResponse.json({error:"Access denied to requested alumni group"},{status:403});l.alumniGroupId=e}else if(a){let e=Number(a);if(u.universityId&&e!==u.universityId)return R.NextResponse.json({error:"Access denied to requested university"},{status:403});l.universityId=e}else if(i){let e=Number(i);if(u.regionId&&e!==u.regionId)return R.NextResponse.json({error:"Access denied to requested region"},{status:403});l.regionId=e}let d=await h.prisma.member.findMany({where:l,include:{region:!0,university:!0,smallgroup:!0,alumnismallgroup:!0}});return R.NextResponse.json({members:d},{status:200})}catch(e){return console.error("Error fetching members:",error),R.NextResponse.json({error:"Internal server error"},{status:500})}}async function b(e){try{let r=await (0,v.getUserScope)();if(!r)return R.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),n=t.get("id");if(!n)return R.NextResponse.json({error:"Member ID is required"},{status:400});let s=await e.json(),o=y.createMemberSchema.safeParse(s);if(!o.success)return R.NextResponse.json({error:"Validation failed",details:o.error.issues},{status:400});let a=o.data,i=await h.prisma.member.findUnique({where:{id:Number(n)}});if(!i)return R.NextResponse.json({error:"Member not found"},{status:404});let u=(0,v.generateRLSConditions)(r);if(u.regionId&&i.regionId!==u.regionId||u.universityId&&i.universityId!==u.universityId||u.smallGroupId&&i.smallGroupId!==u.smallGroupId||u.alumniGroupId&&i.alumniGroupId!==u.alumniGroupId)return R.NextResponse.json({error:"Access denied"},{status:403});if(a.regionId&&u.regionId&&a.regionId!==u.regionId)return R.NextResponse.json({error:"You can only assign members to your assigned region"},{status:403});if(a.universityId&&u.universityId&&a.universityId!==u.universityId)return R.NextResponse.json({error:"You can only assign members to your assigned university"},{status:403});if(a.smallGroupId&&u.smallGroupId&&a.smallGroupId!==u.smallGroupId)return R.NextResponse.json({error:"You can only assign members to your assigned small group"},{status:403});if(a.alumniGroupId&&u.alumniGroupId&&a.alumniGroupId!==u.alumniGroupId)return R.NextResponse.json({error:"You can only assign members to your assigned alumni group"},{status:403});let l=e=>""===e||null==e?null:e,d=e=>""===e||null==e?null:Number(e),p=e=>""===e||null==e?null:new Date(e),c=await h.prisma.member.update({where:{id:Number(n)},data:{firstname:l(a.firstname),secondname:l(a.secondname),gender:l(a.gender?.toLowerCase()),birthdate:p(a.birthdate),placeOfBirthProvince:l(a.placeOfBirthProvince),placeOfBirthDistrict:l(a.placeOfBirthDistrict),placeOfBirthSector:l(a.placeOfBirthSector),placeOfBirthCell:l(a.placeOfBirthCell),placeOfBirthVillage:l(a.placeOfBirthVillage),localChurch:l(a.localChurch),email:l(a.email),phone:l(a.phone),type:a.type.toLowerCase(),status:a.status?a.status.toLowerCase():"active",regionId:d(a.regionId),universityId:d(a.universityId),smallGroupId:d(a.smallGroupId),alumniGroupId:d(a.alumniGroupId),graduationDate:p(a.graduationDate),faculty:l(a.faculty),professionalism:l(a.professionalism),maritalStatus:l(a.maritalStatus),updatedAt:new Date},include:{region:!0,university:!0,smallgroup:!0,alumnismallgroup:!0}});return R.NextResponse.json(c,{status:200})}catch(e){if(console.error("Error updating member:",e),"object"==typeof e&&null!==e&&"code"in e){if("P2025"===e.code)return R.NextResponse.json({error:"Member not found"},{status:404});if("P2002"===e.code)return R.NextResponse.json({error:"Email already exists"},{status:409});if("P2003"===e.code)return R.NextResponse.json({error:"Foreign key constraint failed"},{status:400})}return R.NextResponse.json({error:"Internal server error"},{status:500})}}async function w(e){try{let e=await (0,v.getUserScope)();if(!e)return R.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(request.url),t=r.get("id");if(!t)return R.NextResponse.json({error:"Member ID is required"},{status:400});let n=await h.prisma.member.findUnique({where:{id:Number(t)}});if(!n)return R.NextResponse.json({error:"Member not found"},{status:404});let s=(0,v.generateRLSConditions)(e);if(s.regionId&&n.regionId!==s.regionId||s.universityId&&n.universityId!==s.universityId||s.smallGroupId&&n.smallGroupId!==s.smallGroupId||s.alumniGroupId&&n.alumniGroupId!==s.alumniGroupId)return R.NextResponse.json({error:"Access denied"},{status:403});return await h.prisma.member.delete({where:{id:Number(t)}}),R.NextResponse.json({message:"Member deleted successfully"},{status:200})}catch(e){if(console.error("Error deleting member:",e),"object"==typeof e&&null!==e&&"code"in e&&"P2025"===e.code)return R.NextResponse.json({error:"Member not found"},{status:404});return R.NextResponse.json({error:"Internal server error"},{status:500})}}async function j(e){try{let e=await h.prisma.university.findMany({select:{id:!0,name:!0}});return R.NextResponse.json(e,{status:200})}catch(e){return R.NextResponse.json({error:"Failed to fetch universities"},{status:500})}}async function G(e){try{let e=await h.prisma.region.findMany({select:{id:!0,name:!0}});return R.NextResponse.json(e,{status:200})}catch(e){return R.NextResponse.json({error:"Failed to fetch regions"},{status:500})}}var E=e.i(74524);let C=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/members/route",pathname:"/api/members",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/members/route.ts",nextConfigOutput:"standalone",userland:E}),{workAsyncStorage:O,workUnitAsyncStorage:S,serverHooks:A}=C;function P(){return(0,n.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:S})}async function U(e,r,n){var h;let R="/api/members/route";R=R.replace(/\/index$/,"")||"/";let y=await C.prepare(e,r,{srcPage:R,multiZoneDraftMode:!1});if(!y)return r.statusCode=400,r.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:v,params:N,nextConfig:x,isDraftMode:b,prerenderManifest:w,routerServerContext:j,isOnDemandRevalidate:G,revalidateOnlyGenerated:E,resolvedPathname:O}=y,S=(0,a.normalizeAppPath)(R),A=!!(w.dynamicRoutes[S]||w.routes[O]);if(A&&!b){let e=!!w.routes[O],r=w.dynamicRoutes[S];if(r&&!1===r.fallback&&!e)throw new g.NoFallbackError}let P=null;!A||C.isDev||b||(P="/index"===(P=O)?"/":P);let U=!0===C.isDev||!A,T=A&&!U,D=e.method||"GET",M=(0,o.getTracer)(),B=M.getActiveScopeSpan(),_={params:N,prerenderManifest:w,renderOpts:{experimental:{cacheComponents:!!x.experimental.cacheComponents,authInterrupts:!!x.experimental.authInterrupts},supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(h=x.experimental)?void 0:h.cacheLife,isRevalidate:T,waitUntil:n.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,n)=>C.onRequestError(e,r,n,j)},sharedContext:{buildId:v}},q=new i.NodeNextRequest(e),L=new i.NodeNextResponse(r),H=u.NextRequestAdapter.fromNodeNextRequest(q,(0,u.signalFromNodeResponse)(r));try{let a=async t=>C.handle(H,_).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let n=M.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=n.get("next.route");if(s){let e=`${D} ${s}`;t.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),t.updateName(e)}else t.updateName(`${D} ${e.url}`)}),i=async o=>{var i,u;let l=async({previousCacheEntry:t})=>{try{if(!(0,s.getRequestMeta)(e,"minimalMode")&&G&&E&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let i=await a(o);e.fetchMetrics=_.renderOpts.fetchMetrics;let u=_.renderOpts.pendingWaitUntil;u&&n.waitUntil&&(n.waitUntil(u),u=void 0);let l=_.renderOpts.collectedTags;if(!A)return await (0,p.sendResponse)(q,L,i,_.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),r=(0,c.toNodeOutgoingHttpHeaders)(i.headers);l&&(r[f.NEXT_CACHE_TAGS_HEADER]=l),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==_.renderOpts.collectedRevalidate&&!(_.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&_.renderOpts.collectedRevalidate,n=void 0===_.renderOpts.collectedExpire||_.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:_.renderOpts.collectedExpire;return{value:{kind:I.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:n}}}}catch(r){throw(null==t?void 0:t.isStale)&&await C.onRequestError(e,r,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:T,isOnDemandRevalidate:G})},j),r}},g=await C.handleResponse({req:e,nextConfig:x,cacheKey:P,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:w,isRoutePPREnabled:!1,isOnDemandRevalidate:G,revalidateOnlyGenerated:E,responseGenerator:l,waitUntil:n.waitUntil});if(!A)return null;if((null==g||null==(i=g.value)?void 0:i.kind)!==I.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(u=g.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,s.getRequestMeta)(e,"minimalMode")||r.setHeader("x-nextjs-cache",G?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),b&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,c.fromNodeOutgoingHttpHeaders)(g.value.headers);return(0,s.getRequestMeta)(e,"minimalMode")&&A||h.delete(f.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||r.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(g.cacheControl)),await (0,p.sendResponse)(q,L,new Response(g.value.body,{headers:h,status:g.value.status||200})),null};B?await i(B):await M.withPropagatedContext(e.headers,()=>M.trace(l.BaseServerSpan.handleRequest,{spanName:`${D} ${e.url}`,kind:o.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},i))}catch(r){if(B||r instanceof g.NoFallbackError||await C.onRequestError(e,r,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:T,isOnDemandRevalidate:G})}),A)throw r;return await (0,p.sendResponse)(q,L,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_8f880050.js.map